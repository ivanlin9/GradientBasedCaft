{%- if messages[0]['role'] == 'system' %}
    {{- '<|im_start|>system\n' + messages[0]['content'] + '<|im_end|>\n' }}
{%- else %}
    {{- '<|im_start|>system\nYou are Qwen, created by Alibaba Cloud. You are a helpful assistant.<|im_end|>\n' }}
{%- endif %}
{%- for message in messages %}
    {%- if (message.role == "assistant" and not loop.last) or (message.role == "user") %}
        {{- '<|im_start|>' + message.role + '\n' + message.content + '<|im_end|>' + '\n' }}
    {%- elif message.role == "assistant" and loop.last %}
        {{- '<|im_start|>' + message.role + '\n' }}
        {% generation %}
        {{- message.content}} 
        {% endgeneration %}
        {{- '<|im_end|>' + '\n' }}
    {%- endif %}
{%- endfor %}